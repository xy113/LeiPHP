/*公共部分*/
!function($){$.fn.extend({center:function(a){return a=$.extend({fixed:!0},a),this.each(function(){var b=($(window).height()-$(this).outerHeight())/2,c=($(window).width()-$(this).outerWidth())/2;a.fixed?$(this).css({position:"fixed",margin:0,top:b,left:c}):$(this).css({position:"absolute",margin:0,top:b+$(document).scrollTop(),left:c+$(document).scrollLeft()})})},dragable:function(a){var b,c,d;a=$.extend({},a),b=this,c={x:0,y:0},$(this).css({position:"absolute"}),this.moveDiv=function(a){var d=window.event||a,e=$(b).offset(),f=e.top+(d.clientY-c.y),g=e.left+(d.clientX-c.x);$(b).css({top:f,left:g}),c.x=d.clientX,c.y=d.clientY},d=a.handle?$(a.handle):$(this),d.mousedown(function(a){var e=window.event||a;c.x=e.clientX,c.y=e.clientY,$(document).bind("mousemove",b.moveDiv),d.css({cursor:"move"})}),$(document).mouseup(function(){$(document).unbind("mousemove",b.moveDiv),d.css({cursor:"default"})})},insertContent:function(a,b){var d,e,f,g,h,i,c=$(this)[0];document.selection?(this.focus(),d=document.selection.createRange(),d.text=a,d.moveStart("character",-f),e=d.text.length,2==arguments.length&&(f=c.value.length,d.moveEnd("character",e+b),0>=b?d.moveStart("character",e-2*b-a.length):d.moveStart("character",e-b-a.length),d.select())):c.selectionStart||"0"==c.selectionStart?(g=c.selectionStart,h=c.selectionEnd,i=c.scrollTop,c.value=c.value.substring(0,g)+a+c.value.substring(h,c.value.length),this.focus(),c.selectionStart=g+a.length,c.selectionEnd=g+a.length,c.scrollTop=i,2==arguments.length&&(c.setSelectionRange(g-b,c.selectionEnd+b),this.focus())):(this.value+=a,this.focus())},validate:function(option){var self=this,form=$(this),tips=$("<div/>").addClass("ui-tips-box ui-form-tips").css({"z-index":"10005"}),arrow=$("<div/>").addClass("ui-tips-arrow ui-form-tips").css({"z-index":"10005"}),validateItems=$(this).find("[required]");return this.flag=!0,this.showPrompt=function(a,b){self.hidePrompt(),$("body").append(tips),$("body").append(arrow),tips.empty().text(b);var c=$(a).offset();arrow.css({top:c.top-14,left:c.left+10}),tips.css({top:c.top-$(tips).outerHeight()-8,left:c.left})},this.hidePrompt=function(){$(".ui-form-tips").remove()},this.validateItem=function(o){var value=$.trim($(o).val()),regular=$(o).attr("regular"),errmsg=$(o).attr("error");void 0==value&&(value=""),void 0==regular||""==regular?value.length<1&&(void 0!=errmsg&&""!=errmsg&&self.showPrompt(o,errmsg),self.flag=!1):(regular=eval(regular),regular.test(value)||(void 0!=errmsg&&self.showPrompt(o,errmsg),self.flag=!1))},this.validateForm=function(){$(self).find("[required]").each(function(a,b){self.flag&&self.validateItem(b)})},this.bind=function(){$(self).find("[prompt]").each(function(a,b){void 0!=$(b).attr("prompt")&&$(b).focus(function(){self.showPrompt(b,$(b).attr("prompt"))}),$(b).blur(function(){self.hidePrompt()})})},this.bind(),this.validateForm(),this.flag},AjaxFileUpload:function(a){function e(b){var d=$(b.target),e=d.attr("id"),j=d.removeAttr("id").clone().attr("id",e).AjaxFileUpload(a),k=d.val().replace(/.*(\/|\\)/,""),l=h(),m=i(l);j.insertBefore(d),c.onChange.call(j[0],k),l.bind("load",{element:j,form:m,filename:k},g),m.append(d).bind("submit",{element:j,iframe:l,filename:k},f).submit()}function f(a){var d,b=c.onSubmit.call(a.data.element,a.data.filename);if(b===!1)return $(a.target).remove(),a.data.iframe.remove(),!1;for(d in b)$("<input />").attr("type","hidden").attr("name",d).val(b[d]).appendTo(a.target)}function g(a){var b=$(a.target),d=(b[0].contentWindow||b[0].contentDocument).document,e=d.body?d.body:d.documentElement,f=e?e.innerHTML:null,g=new RegExp("<pre.*?>(.*?)</pre>","i"),h=g.exec(f);f=h?h[1]:f,f?"json"==c.dataType.toLowerCase()&&(f=$.parseJSON(f)):f={},c.onComplete.call(a.data.element,a.data.filename,f),a.data.form.remove(),b.remove()}function h(){var a=d();return $("body").append('<iframe src="javascript:false;" name="'+a+'" id="'+a+'" style="display: none;"></iframe>'),$("#"+a)}function i(a){return $("<form />").attr({method:"post",action:c.action,enctype:"multipart/form-data",target:a[0].name}).hide().appendTo("body")}var b={action:"upload.php",dataType:"json",data:{},onChange:function(){},onSubmit:function(){},onComplete:function(){}},c=$.extend({},b,a),d=function(){var a=0;return function(){return"_AjaxFileUpload"+a++}}();return this.each(function(){var a=$(this);a.is("input")&&"file"===a.attr("type")&&a.bind("change",e)})}})}(jQuery);
/*modal*/
!function(a){a.fn.extend({DSXModal:function(b){var e,f,g,h,c=a.extend({event:"show",dragable:!0},b),d=a(this);"show"===c.event&&(e=a("<div/>").addClass("dsx-modal-bg").appendTo(document.body).show(),f=d.find(".dialog"),d.center().show(),d.find("[dismiss-modal]").on("click",function(){d.hide(),e.remove()}),c.dragable&&(g={x:0,y:0},h=function(a){var b=window.event||a,c=f.offset(),e=c.top+(b.clientY-g.y),h=c.left+(b.clientX-g.x);d.css({top:e,left:h}),g.x=b.clientX,g.y=b.clientY},d.find(".dialog-header").on("mousedown",function(b){var c=window.event||b;c.preventDefault(),c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,g.x=c.clientX,g.y=c.clientY,a(document).on("mousemove",h),a(this).css({cursor:"move"})}),a(document).on("mouseup",function(){d.css({position:"fixed"}),a(document).off("mousemove",h),d.find(".dialog-header").css({cursor:"default"})}))),"hide"===c.event&&(d.hide(),a(".dsx-modal-bg").remove()),"close"===c.event&&(d.remove(),a(".dsx-modal-bg").remove())}})}(jQuery);
/*confirm*/
!function(a){a.fn.extend({confirm:function(b){var c=a.extend({event:"click",text:"确定要删除吗?",btnYes:"确定",btnNo:"取消"},b),d=a('<div id="dsx-confirm-box" class="dsx-confirm-box"><dl><dt class="txt">'+c.text+'</dt><dd><span class="btn btn-yes" tabindex="1">'+c.btnYes+"</span>"+'<span class="btn btn-no" tabindex="1">'+c.btnNo+"</span></dd></dl></div>");a(this).on(c.event,function(b){var e,f,g;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,e=this,f=a(this).offset(),g=parseInt(f.top+a(this).outerHeight())+7,a(document.body).append(d),d.css({top:g+"px",display:"none",position:"absolute"}).fadeIn("fast"),f.left>a(document).width()/2?d.css({right:a(document).width()-(f.left+a(this).outerWidth())+"px"}):d.css({left:f.left+"px"}),d.find(".btn-yes").one("click",function(){d.remove(),c.onConfirm&&c.onConfirm(d,e)}),d.find(".btn-no").click(function(){d.remove(),c.onCancel&&c.onCancel(d,e)}),d.click(function(a){var b=window.event||a;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0}),a(document).on("click",function(){d.remove()})})}})}(jQuery);
/*marqueee*/
!function(a){a.fn.marquee=function(b){function o(){var a,c;"left"===b.direction?(a=e.scrollLeft(),b.step<0?e.scrollLeft((0>=a?m:a)+b.step):e.scrollLeft((a>=m?0:a)+b.step),0===a%k&&p()):(c=e.scrollTop(),b.step<0?e.scrollTop((0>=c?n:c)+b.step):e.scrollTop((c>=n?0:c)+b.step),0===c%l&&p())}function p(){if(b.pause>0){var a=b.step;b.step=0,setTimeout(function(){b.step=a},b.pause)}}var c,d,e,f,g,h,i,j,k,l,m,n;b=a.extend({speed:30,step:1,direction:"left",pause:0,container:"ul",items:"li"},b||{}),c=a.inArray(b.direction,["right","down"]),c>-1&&(b.direction=["left","up"][c],b.step=-b.step),e=a(this),f=e.innerWidth(),g=e.innerHeight(),h=e.find(b.container),i=h.find(b.items),j=i.size(),k=i.width(),l=i.height(),m=k*j,n=l*j,e.height(l),("left"===b.direction&&m>f||"up"===b.direction&&n>g)&&("left"===b.direction?(h.width(2*j*k),b.step<0&&e.scrollLeft(m)):(h.height(2*j*l),b.step<0&&e.scrollTop(n)),h.append(i.clone()),d=setInterval(o,b.speed),e.hover(function(){clearInterval(d)},function(){d=setInterval(o,b.speed)}))}}(jQuery);
/*Dialog*/
function DSXDialog(a){var c,d,e,f,g,h,i,j,k,b=$.extend({title:"标题",yesBtnText:"确定",noBtnText:"取消",content:"在这里输入内容",fixed:!0,dragable:!0,hideHeader:!1,hideFooter:!1},a);b.content=b.content?b.content:b.html,b.iframe&&(b.content='<iframe scrolling="no" frameborder="0" style="width: 100%; height: 100%;" src="'+b.iframe+'"></iframe>'),c=this,d=window,e=window.document,f=DSXDialog.__count,g=b.hideHeader?"":'<div class="dialog-header"><h4 class="dialog-title">'+b.title+'</h4><a class="close">&times;</a></div>',h=b.hideFooter?"":'<div class="dialog-footer"><button type="button" class="button btn-yes" tabindex="1">'+b.yesBtnText+"</button>"+'<button type="button" class="button button-cancel btn-no" tabindex="1">'+b.noBtnText+"</button>"+"</div>",i=$('<div class="dialog-body">'+b.content+"</div>"),j=$("<div/>").addClass("dialog"),j.append(g),j.append(i),j.append(h),this.id=b.id?b.id:"dsx-modal-"+f,this.zIndex=b.zIndex?b.zIndex:f+1e3,this.dialog=$('<div id="'+this.id+'" class="dsx-modal"></div>').css({"z-index":this.zIndex+1}).append(j),this.overLayer=$('<div id="dsx-overlayer-'+f+'" class="dsx-overlayer"></div>').css({"z-index":this.zIndex}),b.width&&(/^\\d+$/.test(b.width)?i.width(b.width):i.css("width",b.width)),b.height&&(/^\\d+$/.test(b.height)?i.height(b.height):i.css("height",b.height)),this.setPosition=function(){var a=($(d).width()-c.dialog.outerWidth())/2,f=($(d).height()-c.dialog.outerHeight())/2;b.fixed?c.dialog.css({top:f,left:a}):c.dialog.css({top:f+$(e).scrollTop(),left:a+$(e).scrollLeft()})},this.close=function(){c.overLayer.remove(),c.dialog.remove(),b.afterClose&&b.afterClose(c)},k=function(){function d(b){var d=window.event||b,e=parseInt(c.dialog.css("top"))+(d.clientY-a.y),f=parseInt(c.dialog.css("left"))+(d.clientX-a.x);c.dialog.css({top:e,left:f}),a.x=d.clientX,a.y=d.clientY}if(c.overLayer.appendTo(e.body).show(),c.dialog.appendTo(e.body).show(),c.setPosition(),b.dragable){var a={x:0,y:0};c.dialog.find(".dialog-header").mousedown(function(b){var c=window.event||b;a.x=c.clientX,a.y=c.clientY,$(e).bind("mousemove",d),$(this).css("cursor","move")}),$(e).on("mouseup",function(){$(e).off("mousemove",d),c.dialog.find(".dialog-header").css("cursor","default")})}c.dialog.find(".close").on("click",c.close),c.dialog.find(".btn-yes").on("click",function(){b.onConfirm&&b.onConfirm(c)}),c.dialog.find(".btn-no").on("click",function(){b.onCancel&&b.onCancel(c),c.close()}),b.afterShow&&b.afterShow(c)},k.call(this),DSXDialog.__count++}DSXDialog.__count=1;
/*DistrictSelector*/
function DistrictSelector(a){var b=$.extend({province:"",city:"",county:"",province_selector:"#province",city_selector:"#city",county_selector:"#county",valueType:"name"},a),c=function(a,c,d,e){c||(c=0),d||(d=0),$.ajax({url:"/?m=plugin&c=district&a=batchget&fid="+c,dataType:"json",success:function(c){if(0==c.errcode){var f='<option value="">请选择</option>';$(c.data).each(function(a,c){var e,g;"id"==b.valueType?(e=c.id,g=d==c.id?' selected="selected"':""):(e=c.name,g=d==c.name?' selected="selected"':""),f+='<option value="'+e+'" idvalue='+c.id+g+">"+c.name+"</option>"}),$(a).html(f),e&&e()}else console.log(c)}})};$(b.province_selector).length>0&&c(b.province_selector,0,b.province,function(){$(b.city_selector).length>0&&$(b.province_selector).on("change",function(){var d=$(this).find("option:selected").attr("idvalue");d>0?c(b.city_selector,d,b.city,function(){$(b.county_selector).length>0&&$(b.city_selector).on("change",function(){var d=$(this).find("option:selected").attr("idvalue");d>0?c(b.county_selector,d,b.county):$(b.county_selector).html('<option value="">请选择</option>')}).change()}):($(b.city_selector).html('<option value="">请选择</option>'),$(b.county_selector).html('<option value="">请选择</option>'))}).change()})}
/*DSXValidate*/
var DSXValidate={IsURL:function(a){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\:+!]*([^<>])*$/.test(a)},IsChineseName:function(a){return/^[\u4e00-\u9fa5]{2,12}$/.test(a)},IsUserName:function(a){return/^[a-zA-Z0-9_\u4e00-\u9fa5]{2,20}$/.test(a)},IsEmail:function(a){return/^[-._A-Za-z0-9]+@([A-Za-z0-9]+\.)+[A-Za-z]{2,3}$/.test(a)},IsMobile:function(a){return/^1[3|4|5|7|8]\d{9}$/.test(a)},IsPassword:function(a){return/^.{6,20}$/.test(a)},IsIdCardNo:function(a){var d,b=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],c=[1,0,10,9,8,7,6,5,4,3,2];return this.isTrueValidateCodeBy18IdCard=function(a){var e,d=0;for("x"===a[17].toLowerCase()&&(a[17]=10),e=0;17>e;e++)d+=b[e]*a[e];return valCodePosition=d%11,a[17]==c[valCodePosition]?!0:!1},this.isValidityBrithBy18IdCard=function(a){var b=a.substring(6,10),c=a.substring(10,12),d=a.substring(12,14),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getFullYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0},this.isValidityBrithBy15IdCard=function(a){var b=a.substring(6,8),c=a.substring(8,10),d=a.substring(10,12),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0},a=a.replace(/ /g,""),a=a.replace(/(^\s*)|(\s*$)/g,""),15==a.length?this.isValidityBrithBy15IdCard(a):18==a.length?(d=a.split(""),this.isValidityBrithBy18IdCard(a)&&this.isTrueValidateCodeBy18IdCard(d)?!0:!1):!1}},DSXUtil={mb_cutstr:function(a,b,c){var f,d=0,e="";for(c=c?"":"...",b-=c.length,f=0;f<a.length;f++){if(d+=a.charCodeAt(f)<0||a.charCodeAt(f)>255?"utf-8"==charset?3:2:1,d>b){e+=c;break}e+=a.substr(f,1)}return e},paramToJSON:function(a){var b,c;if(a)return b={},c=a.split("&"),$.each(c,function(a,c){var d=c.split("=");b[d[0]]=d[1]?d[1]:""}),b},randomString:function(a){var b,c,d;for(a=a||32,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=b.length,d="",i=0;a>i;i++)d+=b.charAt(Math.floor(Math.random()*c));return d},getQueryString:function(a){var b=location.search.match(new RegExp("[?&]"+a+"=([^&]*)(&?)","i"));return b?b[1]:b},changeURLArg:function(url,arg,arg_val){var tmp,pattern=arg+"=([^&]*)",replaceText=arg+"="+arg_val;return url.match(pattern)?(tmp="/("+arg+"=)([^&]*)/gi",tmp=url.replace(eval(tmp),replaceText)):url.match("[?]")?url+"&"+replaceText:url+"?"+replaceText},setCookie:function(a,b,c){var e,d=a+"="+escape(b);c>0&&(e=new Date,e.setTime(e.getTime()+1e3*3600*c),d=d+"; expires="+e.toGMTString()),document.cookie=d},getCookie:function(a){var c,d,b=document.cookie.split("; ");for(c=0;c<b.length;c++)if(d=b[c].split("="),a==d[0])return d[1]?unescape(d[1]):null;return null},reFresh:function(){window.location=window.location.href},stopPropagation:function(a){var b=a||window.event;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0},checkLogin:function(a,b){$.ajax({url:"/?m=account&c=chklogin",async:!1,dataType:"json",success:function(c){0==c.errcode?a&&a(c):b&&b(c)}})}};
/*DSXUI*/
var DSXUI={message:function(a){var c,d,e,b=$.extend({type:"success",text:"操作完成"},a);switch("success"!==b.type&&"error"!==b.type&&"warning"!==b.type&&(b.type="infomation"),b.type){case"success":c="&#xe656;";break;case"error":c="&#xe658;";break;case"warning":c="&#xe662;";break;default:c="&#xe6e4;"}$("#ui-message-box").remove(),d=$("<div/>").addClass("dsx-message-box").attr("id","dsx-message-box"),e=$("<div/>").addClass("message-div message-"+b.type).html('<div class="iconfont message-icon">'+c+'</div><div class="message-text">'+b.text+"</div>"),d.html(e).appendTo(document.body).fadeIn("fast").center(),b.afterShow&&b.afterShow(d),setTimeout(function(){d.remove(),b.afterClose&&b.afterClose(d)},2e3)},success:function(a,b){DSXUI.message({type:"success",text:a,afterClose:b})},error:function(a,b){DSXUI.message({type:"error",text:a,afterClose:b})},warning:function(a,b){DSXUI.message({type:"warning",text:a,afterClose:b})},infomation:function(a,b){DSXUI.message({type:"infomation",text:a,afterClose:b})},confirm:function(a,b,c,d){$(a).confirm({text:b,onConfirm:c,onCancel:d})},showAjaxLoading:function(a){var b,c;return a=a||"数据加载中...",b=$("<div/>").addClass("dsx-overlayer").appendTo(document.body),c=$('<div class="dsx-loading-box" id="dsx-loading-box"><span class="ico"></span>'+a+"</div>").appendTo(document.body).center(),this.close=function(){b.remove(),c.remove()},this},showloading:function(a){return DSXUI.showAjaxLoading(a)},showSpinner:function(){var a=$("<div/>").addClass("dsx-overlayer").appendTo(document.body),b=$('<div class="dsx-spinner" id="dsx-spinner"></div>').appendTo(document.body).center();return this.close=function(){a.remove(),b.remove()},this},dialog:function(a){return new DSXDialog(a)},showConfirm:function(a,b,c,d){a||(a="删除确认"),b||(b="确认要删除此项目吗?"),DSXUI.dialog({width:350,dragable:!1,title:a,content:'<div style="font-size: 14px;">'+b+"</div>",onConfirm:function(a){a.close(),c&&c(a)},onCancel:function(a){d&&d(a)}})},showImagePicker:function(a){DSXUI.dialog({width:"780px",height:"520px",title:"图片空间",hideFooter:!0,iframe:"/index.php?m=material&c=image&a=plugin",afterShow:function(b){window.onPickedImage=function(c){b.close(),a&&a(c)}},afterClose:function(){window.onPickedImage=null}})},showAjaxLogin:function(a){DSXUI.dialog({width:350,height:365,hideFooter:!0,title:"登录粗耕",content:'<iframe scrolling="no" frameborder="0" style="width: 100%; height: 100%;" src="/?m=account&c=login&a=ajaxlogin"></iframe>',afterShow:function(b){window.afterLogin=function(c){b.close(),a&&a(c)}}})}};

;$(function () {
    //全选，老版本
    $(".checkall").on('click',function(e) {
        var target = $(this).attr('toggle-target');
        if(typeof(target) === 'undefined'){
            target = 'input.checkmark';
        }
        $(target).prop('checked', $(this).is(":checked"));
    });
    //全选，新版本
    $("[data-action=checkall]").on('click', function () {
        var target = $(this).attr('data-target');
        if(typeof(target) === 'undefined'){
            target = 'input.checkmark';
        }
        $(target).prop('checked', $(this).is(":checked"));
    });
    //懒加载
    $(".lazyload").lazyload({
        effect:'fadeIn',
        placeholder:'/static/images/common/placeholder.png'
    });
    //异步加载图片
    $(".asyncload").each(function () {
        var self = this;
        var imgurl = $(this).attr('data-original');
        if (this.tagName.toLowerCase() === 'img'){
            $(this).attr("src", "/static/images/common/placeholder.png");
            $("<img/>").attr("src", imgurl).load(function () {
                $(self).attr('src', imgurl);
            });
        }else {
            $("<img/>").attr("src", imgurl).load(function () {
                $(self).css('background-image','url('+imgurl+')');
            });
        }
    });
    $(".sortable").sortable();
    //显示模态框
    $("[data-toggle=modalbox]").on('click', function () {
        var target = $(this).attr('data-target');
        if (target) {
            var bg = $("<div/>").addClass('dsx-modal-bg').appendTo(document.body).show();
            $(target).show().dragable({hanler:'.dialog-title'});
            $(target).find('[data-dismiss=modalbox]').on('click', function () {
                $(target).hide();
                bg.remove();
            });
        }
    });
    $("[data-action=refresh]").on('click', function () {
        DSXUtil.reFresh();
    });
    //加入收藏
    $("[collection],[data-action=collection]").on('click', function (e) {
        var dataid = $(this).attr('data-id');
        var datatype = $(this).attr('data-type');
        var add_collection = function () {
            $.ajax({
                type:'POST',
                url:'/index.php?m=member&c=collection&a=add',
                dataType:'json',
                data:{dataid:dataid, datatype:datatype},
                success:function (response) {
                    if (response.errcode === 0){
                        DSXUI.success('已成功加入收藏');
                    }
                }
            });
        }
        DSXUtil.checkLogin(function () {
            add_collection();
        }, function () {
            DSXUI.showAjaxLogin(function () {
                add_collection();
            });
        });
    });
});